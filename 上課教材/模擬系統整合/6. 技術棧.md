SI/PI 模擬自動化流程的模組化與系統整合
---

### 引言
這篇章節將深入探討如何利用 Python 及相關技術，構建一個模組化且高效的 SI/PI 模擬自動化系統。我們將涵蓋從需求分析、技術選型、系統設計到具體實現的各個方面，並強調如何利用 AI 技術來提升開發效率和系統性能。

### 腳本以及流程自動化工具差異
在模擬自動化中，腳本通常指的是單一任務或功能的程式碼片段，例如打開一個設計檔案、設置模擬參數或提取結果。而流程自動化則涉及將多個腳本和任務組合起來，形成一個完整的工作流程（Workflow），以實現從設計到分析再到報告生成的全自動化過程。

自動化流程通常需要更複雜的系統設計，包括錯誤處理、用戶交互界面（GUI）、數據管理和報告生成等功能。這就要求開發者不僅要具備腳本編寫能力，還需要掌握系統架構設計和軟體工程的基本原則。

> 一次性代碼片段可能解決一個小問題，用過即棄；無法形成可持續維護的系統。


### 選題及技術棧選擇
選擇合適的技術棧對於成功實現模擬自動化至關重要。Python 是目前最受歡迎的選擇，因為它擁有豐富的科學計算和數據處理庫，如 NumPy、Pandas 和 Matplotlib。此外，Python 也有強大的 GUI 庫，如 PyQt、Tkinter 和 Pywebview，可以用於構建用戶界面。

PyAEDT 和 PyEDB 是專門針對 ANSYS 電磁模擬軟體的 Python 庫，提供了與 ANSYS 軟體互動的 API，使得開發者可以通過程式碼來控制模擬流程，實現自動化。

### 使用者需求分析與功能規劃
在開始開發之前，深入了解使用者的需求是關鍵。這包括確定他們的技術水平、工作流程以及他們希望自動化的具體任務。根據這些需求，制定詳細的功能規劃，確保開發出的系統能夠真正解決使用者的痛點。


#### GUI 優先？算法優先？
根據不同的應用場景和用戶需求，決定是先開發 GUI 還是先實現核心算法是至關重要的。這一決策將影響整個開發流程和最終產品的可用性。

如果是GUI優先，則需要更多關注用戶體驗和界面設計，確保系統易於使用且直觀。如果是算法優先，則需要專注於核心功能的實現和性能優化，確保系統能夠高效地完成所需的模擬任務。

### 模擬自動化系統的目錄結構與管理
與腳本開發不同，一個完整的模擬自動化系統通常包含多個模組和配置文件。良好的目錄結構和依賴管理對於團隊協作和長期維護至關重要。對AI而言，清晰的目錄結構也有助於其理解和生成相關代碼。

- .git/：版本控制目錄，包含所有 Git 相關的元數據。
- .venv/：Python 虛擬環境目錄，隔離專案依賴。
- src/：源代碼目錄，包含所有核心模組和功能實現。
  - gui/：GUI 相關代碼和資源。
  - core/：核心算法和模擬邏輯。
  - utils/：輔助工具和通用函式庫。
- tests/：測試代碼和測試用例。
- docs/：專案文檔和使用說明。
- config.json：配置文件和設定參數。
- scripts/：獨立腳本和命令行工具。
- pyproject.toml：專案配置文件，定義依賴和元數據。
- README.md：專案說明文件，介紹專案背景和使用方法。

### 


### .venv 虛擬環境的建立與管理
使用虛擬環境可以確保每個模擬自動化專案都有獨立的依賴包，避免不同專案之間的衝突。套件底下獨立的.venv目錄可以讓AI更好地理解專案的依賴關係，從而生成更準確的代碼。

移植到其他機器時，只需複製專案目錄並重新建立虛擬環境，然後使用 uv sync 安裝依賴即可。

### uv 的環境設定與依賴管理
捨棄傳統的 pip 和 requirements.txt，改用 uv 來管理專案依賴和環境設定。uv 是一個輕量級的 Python Web 框架，適合用於構建高效的模擬自動化系統。速度快且易於使用，使其成為開發應用程式的理想選擇。
- uv init：初始化 uv 專案結構。
- uv sync：同步依賴和配置。
- uv add：添加新的路由和功能模組。
- uv run：啟動 uv 應用程式。

### 算法開發
在模擬自動化系統中，核心算法的開發是關鍵。舉例來說，在一條路徑上兩側距離offset等間距ds放置gnd vias，輸入路徑座標點陣列，offset，ds；計算並返回vias座標點陣列。這類問題背後是幾何計算，對一般開發者來說可能較為複雜，可以利用AI來生成相關代碼。並將算法包成模組，上層代碼只需調用即可結合PyEDB/PyAEDT，並可以在AEDT當中生成vias。

訣竅是提供一組從AEDT/EDB中提取的座標點陣列，讓AI根據這些點計算vias位置，並生成圖片來驗證結果。如果圖片有錯，可以持續調整prompt直到結果正確。將算法與PyEDB/PyAEDT分離，可以大幅簡化開發流程。


### GUI解耦合與借力AI開發

用gemini.md來設計GUI佈局，用chat來完善細節。三段式布局設計：
1. 選單欄（Menu Bar）或工具欄（Tool Bar），放置常用功能按鈕和選項。
2. Tab頁籤（Tab Pages），可以分別在左中右三個區域規劃Panel，並利用AI生成相應的代碼。
3. 狀態欄（Status Bar），由所有模組共用，顯示當前狀態和提示信息。可以動態更新執行進度。

複雜流程可以透過Tab設計來解耦合，並利用AI來生成各個模組的代碼，從而提高開發效率和系統的可維護性。

MVC設計模式可以幫助實現GUI與業務邏輯的分離，從而提高系統的可維護性和擴展性。

### Google Antigravity IDE
Google Antigravity IDE 是一個基於AU的開發環境，集成了強大的 AI 助手，可以幫助開發者更快地完成代碼編寫和調試工作。利用這個 IDE，可以輕鬆地與 AI 互動，生成高質量的代碼片段，並進行即時測試和調試。


### Pywebview的GUI設計與實現
Pywebview 是一個輕量級的跨平台 GUI 庫，允許使用 HTML/CSS/JavaScript 來構建桌面應用程式的界面。它與 PyEDB/PyAEDT 結合，可以實現高效的模擬自動化系統。

與QT/PySide6相比，Pywebview 可以做出Layout介面，而非單純傳統控件組成的GUI，這對於某些模擬應用場景更為合適。

### Gemini.md編寫
prompt engineering是與AI互動的關鍵技術。編寫一個清晰且結構化的gemini.md文件，有助於AI更好地理解需求並生成高質量的代碼。

Vscode Copilot補全功能可以協助開發者更快地完成gemini.md的編寫，提升整體Prompt開發效率。

### Git版本控制
AI高效生成代碼的同時，版本控制變得尤為重要。使用Git可以幫助團隊追蹤代碼變更，管理不同版本，並確保代碼的穩定性。

如果出現問題，可以輕鬆回滾到之前的穩定版本，這對於AI生成代碼的實驗性質尤為重要。



### PyEDB與PyAEDT外部程序編寫
透過argparse等庫，可以實現命令行參數解析，從而使模擬自動化系統更加靈活和易於使用。資料複雜則可以透過JSON或YAML進行資料交換。

此外可以徹底解耦合GUI與模擬邏輯，實現更好的模組化設計。

### 探索PyEDB與PyAEDT屬性及方法
dir及help函數可以幫助開發者探索PyEDB與PyAEDT的屬性和方法，從而更好地利用這些庫來實現模擬自動化。這裡介紹一個結合dir與help的視窗程式。




### 安裝與配置
如何在run.bat當中利用uv來啟動GUI應用程式，並確保所有依賴都正確安裝和配置。如此在其他機器上只需複製專案目錄並運行run.bat即可啟動應用程式。





