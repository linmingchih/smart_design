è™›æ“¬ç’°å¢ƒåˆå§‹åŒ–èˆ‡å»ºç½®è…³æœ¬
---

é€™æ®µ Windows æ‰¹æ¬¡æª”ç”¨æ–¼è‡ªå‹•åµæ¸¬å®‰è£æ–¼ç³»çµ±ä¸Šçš„ ANSYSEM è»Ÿé«”ç‰ˆæœ¬ï¼Œä¸¦æ ¹æ“šæœ€æ–°ç‰ˆæœ¬è¨­å®šå°æ‡‰ Python ç’°å¢ƒã€‚è‹¥å°šæœªå»ºç«‹è™›æ“¬ç’°å¢ƒï¼ˆvenvï¼‰ï¼Œæœƒè‡ªå‹•å»ºç«‹ä¸¦å®‰è£å¿…è¦å¥—ä»¶ï¼Œæœ€å¾ŒåŸ·è¡Œ `main.py` è…³æœ¬ã€‚

ä¸»è¦ç›®çš„æ˜¯ç‚ºäº†å°‡æ•´å€‹å°ˆæ¡ˆè³‡æ–™å¤¾è¤‡è£½åˆ°å…¶ä»–é›»è…¦æ™‚ï¼Œä»èƒ½å¿«é€Ÿå»ºç«‹å¯é‹è¡Œçš„ç’°å¢ƒï¼Œé™ä½äººå·¥å®‰è£çš„æˆæœ¬èˆ‡éŒ¯èª¤ç‡ã€‚ä¸éœ€è¦è¤‡è£½ `.venv` è³‡æ–™å¤¾ï¼Œé¿å…æ”œå¸¶éå¤§æª”æ¡ˆï¼Œåªéœ€ä¿ç•™å¿…è¦çš„åŸå§‹ç¨‹å¼èˆ‡é€™å€‹æ‰¹æ¬¡æª”ï¼Œå³å¯åœ¨æ–°æ©Ÿå™¨ä¸Šé‡æ–°å»ºç«‹è™›æ“¬ç’°å¢ƒèˆ‡å®‰è£å¥—ä»¶ã€‚

### åŠŸèƒ½

* è‡ªå‹•åµæ¸¬ç³»çµ±ä¸­æœ€æ–°çš„ ANSYSEM\_ROOT ç’°å¢ƒè®Šæ•¸
* æœå°‹å°æ‡‰ç‰ˆæœ¬ä¸‹çš„ Python åŸ·è¡Œæª”
* å»ºç«‹ä¸¦å•Ÿç”¨ Python è™›æ“¬ç’°å¢ƒ `.venv`
* åˆæ¬¡åŸ·è¡Œæ™‚è‡ªå‹•å®‰è£ `pyaedt`, `pyedb`, `flask` ç­‰å¿…è¦å¥—ä»¶
* æœ€å¾ŒåŸ·è¡Œ `main.py`

### æµç¨‹æ¶æ§‹

1. **é¸æ“‡æœ€æ–°ç‰ˆæœ¬çš„ ANSYSEM\_ROOTxxx**ï¼š

   * é è¨­å¾å¤šå€‹å·²çŸ¥ç‰ˆæœ¬è™Ÿç¢¼ä¸­ï¼ˆå¦‚ 260ã€252...ï¼‰æ‰¾å‡ºç’°å¢ƒè®Šæ•¸å·²å®šç¾©è€…ï¼Œä¸¦æŒ‘é¸ç‰ˆæœ¬è™Ÿæœ€å¤§çš„ä½œç‚ºæœ€æ–°ç‰ˆæœ¬ã€‚

2. **å°‹æ‰¾ Python è·¯å¾‘**ï¼š

   * æ ¹æ“šé¸å‡ºçš„ ANSYSEM\_ROOT è·¯å¾‘ï¼Œå¾€ `../commonfiles/CPython` æœå°‹ `python.exe`

3. **å»ºç«‹/å•Ÿç”¨è™›æ“¬ç’°å¢ƒèˆ‡å®‰è£å¥—ä»¶**ï¼š

   * è‹¥ `.venv` å°šæœªå­˜åœ¨ï¼Œå‰‡å»ºç«‹è™›æ“¬ç’°å¢ƒä¸¦å®‰è£å¿…è¦ Python å¥—ä»¶
   * è‹¥å·²å­˜åœ¨ï¼Œå‰‡ç›´æ¥å•Ÿç”¨è™›æ“¬ç’°å¢ƒï¼Œè·³éå®‰è£æµç¨‹

4. **åŸ·è¡Œä¸»ç¨‹å¼**ï¼š

   * å˜—è©¦åŸ·è¡Œç•¶å‰è³‡æ–™å¤¾ä¸‹çš„ `main.py`

### è£œå……èªªæ˜

* `call set "val=%%ANSYSEM_ROOT%%V%%"` æ˜¯ä¸€ç¨®æŠ€å·§ï¼Œé€éé–“æ¥å±•é–‹ä¾†å–å¾— `ANSYSEM_ROOTxxx` çš„å€¼
* `enabledelayedexpansion` ç”¨æ–¼è®“è¿´åœˆå…§çš„è®Šæ•¸å³æ™‚ç”Ÿæ•ˆï¼Œä¾‹å¦‚ `!val!`
* `curl -I https://pypi.org` ç”¨ä¾†æª¢æŸ¥æ˜¯å¦å¯ä»¥é€£ä¸Š PyPIï¼ˆPython å¥—ä»¶ä¸‹è¼‰ç«™ï¼‰
* `.venv_installed.flag` æ˜¯å®‰è£å®Œæˆçš„æ¨™è¨˜æª”ï¼Œé›–ç„¶åœ¨é€™æ®µä¸­åƒ…å¯«å…¥ï¼Œæœªä½¿ç”¨

### ç¯„ä¾‹ç¨‹å¼

```batch
@echo off
chcp 65001 >nul
setlocal enabledelayedexpansion

set versions=260 252 251 242 241 232
set "latest_version=0"
set "latest_root="

for %%V in (%versions%) do (
    call set "val=%%ANSYSEM_ROOT%%V%%"
    if defined val (
        echo âœ… æ‰¾åˆ° ANSYSEM_ROOT%%V%% = !val!
        if %%V GTR !latest_version! (
            set "latest_version=%%V"
            set "latest_root=!val!"
        )
    )
)

if not defined latest_root (
    echo âŒ ç„¡æ³•æ‰¾åˆ°ä»»ä½• ANSYSEM_ROOTxxx ç’°å¢ƒè®Šæ•¸
    pause
    exit /b
)

echo âœ… æœ€æ–°ç‰ˆæœ¬ç‚º ANSYSEM_ROOT%latest_version%
echo ğŸ“ å°æ‡‰è·¯å¾‘ï¼š!latest_root!

set "search_root=!latest_root!\..\commonfiles\CPython"
set "PYTHON_PATH="

for /f "delims=" %%F in ('dir /b /s /a-d "!search_root!\python.exe" 2^>nul') do (
    set "PYTHON_PATH=%%F"
)

if not defined PYTHON_PATH (
    echo âŒ æ‰¾ä¸åˆ° python.exe
    pause
    exit /b
)

echo âœ… ä½¿ç”¨ Pythonï¼š!PYTHON_PATH!

if not exist ".venv" (
    echo ğŸ› ï¸ å»ºç«‹ .venv...
    "!PYTHON_PATH!" -m venv ".venv"
    if errorlevel 1 (
        echo âŒ venv å»ºç«‹å¤±æ•—
        pause
        exit /b
    )

    call ".venv\Scripts\activate.bat"
    if errorlevel 1 (
        echo âŒ ç„¡æ³•å•Ÿç”¨è™›æ“¬ç’°å¢ƒ .venv
        pause
        exit /b
    )

    echo ğŸŒ æª¢æŸ¥èˆ‡ PyPI çš„é€£ç·šç‹€æ…‹...
    curl -I https://pypi.org -m 5 -o nul -s -S
    if %errorlevel%==0 (
        echo âœ… PyPI é€£ç·šæ­£å¸¸ï¼Œé–‹å§‹å®‰è£å¥—ä»¶...
        python -m pip install --upgrade pip
        pip install pyaedt pyedb flask
        echo å·²å®Œæˆå®‰è£ > ".venv_installed.flag"
    ) else (
        echo âŒ ç„¡æ³•é€£ç·šè‡³ PyPI (https://pypi.org)
        echo ğŸ”’ å¯èƒ½åŸå› ï¼šé˜²ç«ç‰† / ä»£ç†ä¼ºæœå™¨ / ç¶²è·¯ç­–ç•¥é™åˆ¶
        echo ğŸ›‘ å®‰è£ä¸­æ­¢ï¼›è«‹ç¢ºèªç¶²è·¯ç’°å¢ƒå¾Œå†åŸ·è¡Œï¼ˆæˆ–å…ˆè¡Œé›¢ç·šå®‰è£ï¼‰
        pause
        exit /b
    )
) else (
    echo ğŸ“¦ åµæ¸¬åˆ°å·²å­˜åœ¨ .venvï¼Œç•¥éå»ºç«‹èˆ‡ pip å®‰è£
    call ".venv\Scripts\activate.bat"
)

if exist "main.py" (
    echo â–¶ï¸ åŸ·è¡Œ main.py...
    python main.py
) else (
    echo âŒ æ‰¾ä¸åˆ° main.pyï¼Œè«‹å°‡å®ƒæ”¾åœ¨æ­¤è³‡æ–™å¤¾
)

endlocal
pause
```
