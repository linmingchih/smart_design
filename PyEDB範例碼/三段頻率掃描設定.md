三段頻率掃描設定
---

### 目的

這段程式碼的主要目標是**自動化配置 Ansys EDB (Electronics Database) 的模擬環境**。透過程式碼，它可以快速且精確地建立兩種常見的電磁模擬 Setup（SIwave 的 S 參數模擬與 HFSS 模擬），並統一設定複雜的頻率掃描範圍。這通常用於批次處理 PCB 或封裝設計，避免人工手動設定的繁瑣與錯誤。

### 功能

1.  **初始化 EDB 環境**：啟動指定版本的 Ansys EDB 介面。
2.  **建立 SIwave SYZ 設定**：新增一個用於萃取 S 參數的 SIwave setup。
3.  **定義複合頻率掃描**：建立一個包含直流 (DC)、對數 (Log) 與線性 (Linear) 刻度的混合頻率表。
4.  **建立 HFSS 設定**：新增 HFSS 模擬 setup，並設定單頻點的收斂條件（Adaptive Pass）。
5.  **專案管理**：將設定好的專案另存為新的 `.aedb` 檔案並安全關閉。

### 流程架構

1.  **環境啟動**：宣告 `Edb` 物件，指定使用 2024.1 版本。
2.  **SIwave 流程**：
      * 建立名為 `"siwave_setup"` 的設定檔。
      * 定義 `frequency_range` 列表（包含 DC 點、低頻對數掃描、高頻線性掃描）。
      * 將此掃描範圍加入 setup。
3.  **HFSS 流程**：
      * 建立名為 `"hfss_setup"` 的設定檔。
      * 設定適應性網格剖分 (Adaptive Mesh) 的頻率與收斂條件 (Max Passes, Delta S)。
      * 同樣將上述定義好的頻率掃描範圍加入此 setup。
4.  **結束作業**：將修改後的資料庫儲存至指定路徑，並釋放資源。

### 補充說明

在這段程式碼中，有幾個值得注意的語法與概念：

  * **`frequency_range` (列表中的列表 List of Lists)**：
    這是 Python 中常見的資料結構，但在這裡是為了配合 PyEDB 的 API 格式。它把三個不同的掃描區間包在一個大列表裡：

      * `["linear count", ...]`：指定只有 1 個點（通常用於 DC 0Hz）。
      * `["log scale", ...]`：低頻段使用對數刻度，適合觀察低頻變化劇烈的特性。
      * `["linear scale", ...]`：高頻段使用線性刻度，固定步階（Step）進行掃描。
        這種寫法讓使用者能一次性定義「混合式」的掃描策略。

  * **`pyedb` 函式庫**：
    這是 Ansys 官方提供的 Python 自動化工具（屬於 PyAEDT 家族）。它允許使用者在不開啟圖形介面 (GUI) 的情況下，直接對 `.aedb` 資料夾進行讀寫操作，是進行 EDA 自動化的核心工具。

### 範例程式

```python
from pyedb import Edb

# 1. 初始化 EDB 物件，指定使用 2024.1 版本的 Ansys 環境
# 如果不指定路徑，通常會開啟當前工作目錄下的專案或建立新專案
edb = Edb(version='2024.1')

# 2. 建立 SIwave 的 SYZ (S參數) 模擬設定，命名為 "siwave_setup"
setup = edb.create_siwave_syz_setup("siwave_setup")

# 3. 設定頻率掃描範圍 (Frequency Sweep)
# 這裡定義了一個混合式的掃描策略，包含三個部分：
# - DC 點: 0Hz
# - 低頻段: 1Hz 到 50MHz，使用對數刻度 (Log scale)，取 50 個點
# - 高頻段: 50MHz 到 5GHz，使用線性刻度 (Linear scale)，步階為 50MHz
frequency_range = [
    ["linear count", "0Hz", "0Hz", 1],
    ["log scale", "1Hz", "50MHz", 50],
    ["linear scale", "50MHz", "5GHz", '50MHz'],
]

# 將上述定義好的頻率範圍加入到目前的 setup 中
setup.add_sweep('sweep', frequency_set=frequency_range)

# 4. 建立 HFSS 模擬設定，命名為 "hfss_setup"
setup = edb.create_hfss_setup("hfss_setup")

# 設定 HFSS 的求解頻率與收斂條件
# - frequency: 自適應網格剖分的頻率點 (2GHz)
# - max_num_passes: 最大疊代次數 (20次)
# - max_delta_s: 收斂誤差標準 (0.01，即 1%)
setup.set_solution_single_frequency(frequency='2GHz', 
                                    max_num_passes=20,
                                    max_delta_s=0.01)

# 同樣將頻率掃描範圍加入到 HFSS setup 中
setup.add_sweep('sweep', frequency_set=frequency_range)

# 5. 儲存與關閉
# 將目前的設定與修改另存為一個新的 AEDB 專案資料夾
edb.save_edb_as('d:/demo7/test2.aedb')

# 關閉 EDB 連線，釋放記憶體資源
edb.close_edb()
```

![](/assets/2025-11-20_09-24-46.png)

